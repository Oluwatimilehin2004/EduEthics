<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <link rel="stylesheet" href="./output.css">
</head>
<body class="bg-backgroundColor">
    <main class="w-[100%] lg:h-[100vh] space-y-5">
        <!-- Header -->
        <navbar class="lg:h-[12%] py-5 lg:py-0 w-full items-center flex justify-end font-[Inter] px-4">
            <a href="./profile.html" class="cursor-pointer bg-white text-[11px] lg:text-[13px] mr-3 hover:text-white hover:bg-bgBlue">
                <button class="border py-2 px-4 shadow-sm">
                    Back To Profile
                </button>
            </a>
            <a href="./index.html" class="cursor-pointer bg-white text-[11px] lg:text-[13px] hover:text-white hover:bg-mainGreen">
                <button class="border py-2 px-4 shadow-sm">
                    Back To Home
                </button>
            </a> 
        </navbar>
        
        <div class="px-8 lg:max-w-[50%] w-full font-[Inter] lg:mx-8">
            <div class="mb-6">
                <h1 class="text-[20px] lg:text-[22px] font-medium mb-1">Account</h1>
                <p class="text-[10px] lg:text-[12px] text-gray-400" id="emails"></p>
            </div>
            <form id="edit-profile-form" class="space-y-8" enctype="multipart/form-data">
                <div class="block items-center justify-between w-full relative">
                    <label class="block text-[12px] lg:text-[14px] mb-2">Profile Picture</label>
                    <div class="lg:w-[20%] w-[45%] space-y-2 flex flex-col justify-center items-center bg-white py-4 rounded-sm border">
                        <svg width="50px" height="50px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C7.58 2 4 5.58 4 10V10.69C2.42 11.81 1.5 13.79 1.5 16C1.5 19.87 4.63 23 8.5 23H19C21.76 23 24 20.76 24 18C24 15.24 21.76 13 19 13H18.71C17.82 10.08 15.13 8 12 8C11.37 8 10.75 8.11 10.17 8.31C9.53 5.9 7.38 4 5 4C2.79 4 1 5.79 1 8C1 9.79 2.21 11.35 4 11.81V12C4 8.13 7.13 5 11 5C14.87 5 18 8.13 18 12H19C21.21 12 23 13.79 23 16C23 18.21 21.21 20 19 20H8.5C5.74 20 3.5 17.76 3.5 15C3.5 12.92 4.96 11.17 7 10.51V10C7 6.69 9.69 4 13 4C16.31 4 19 6.69 19 10H17.5C17.5 7.24 15.26 5 12.5 5C9.74 5 7.5 7.24 7.5 10V10.5C7.5 10.78 7.72 11 8 11H16C16.28 11 16.5 10.78 16.5 10.5V10C16.5 6.42 13.58 3.5 10 3.5C6.42 3.5 3.5 6.42 3.5 10V10.69C2.42 11.81 1.5 13.79 1.5 16C1.5 19.87 4.63 23 8.5 23H19C21.76 23 24 20.76 24 18C24 15.24 21.76 13 19 13H18.71C17.82 10.08 15.13 8 12 8C11.37 8 10.75 8.11 10.17 8.31C9.53 5.9 7.38 4 5 4C2.79 4 1 5.79 1 8C1 9.79 2.21 11.35 4 11.81V12C4 8.13 7.13 5 11 5C14.87 5 18 8.13 18 12H19C21.21 12 23 13.79 23 16C23 18.21 21.21 20 19 20H8.5C5.74 20 3.5 17.76 3.5 15C3.5 12.92 4.96 11.17 7 10.51V10C7 6.69 9.69 4 13 4C16.31 4 19 6.69 19 10H17.5C17.5 7.24 15.26 5 12.5 5C9.74 5 7.5 7.24 7.5 10V10.5C7.5 10.78 7.72 11 8 11H16C16.28 11 16.5 10.78 16.5 10.5V10C16.5 6.42 13.58 3.5 10 3.5C6.42 3.5 3.5 6.42 3.5 10V10.69C2.42 11.81 1.5 13.79 1.5 16C1.5 19.87 4.63 23 8.5 23H19C21.76 23 24 20.76 24 18C24 15.24 21.76 13 19 13H18.71C17.82 10.08 15.13 8 12 8C11.37 8 10.75 8.11 10.17 8.31C9.53 5.9 7.38 4 5 4C2.79 4 1 5.79 1 8C1 9.79 2.21 11.35 4 11.81V12Z" fill="#C4C4C4"/>
                        </svg>
                        <p class="text-gray-400 text-[10px] lg:text-[12px]">Choose File</p>
                        <input type="file" class="hidden" id="fileInput">
                        <label for="fileInput" class="cursor-pointer bg-bgBlue text-white px-4 py-1 mt-2 text-[12px] lg:text-[14px] hover:bg-mainGreen">Choose File</label>
                    </div>
                    <div class="absolute max-w-[50%] lg:max-w-[80%] lg:top-[50%] top-[30%] right-0">
                        <p class="ml-8 text-[10px] lg:text-[12px] text-gray-400">Please upload an image in JPG, PNG, or SVG format. The required resolution is 1080x1080 pixels or higher for the best quality</p>
                    </div>
                </div>
                <div class="w-full mb-3 lg:mb-0">
                    <label class="block text-[12px] lg:text-[14px] mb-2">Username</label>
                    <input type="text" id="username" name="username" class="appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline font-light text-[12px] lg:text-[14px]">
                </div>
                <div class="flex lg:flex-row flex-col lg:space-x-2">
                    <div class="w-full mb-3 lg:mb-0">
                        <label class="block text-[12px] lg:text-[14px] mb-2">First Name</label>
                        <input type="text" id="first_name" name="first_name" class="appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline font-light text-[12px] lg:text-[14px]">
                    </div>
                    <div class="w-full">
                        <label class="block text-[12px] lg:text-[14px] mt-3">Last Name</label>
                        <input type="text" id="last_name" name="last_name" class="appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline font-light text-[12px] lg:text-[14px]">
                    </div>    
                </div>
                <div class="flex lg:flex-row flex-col lg:space-x-2">
                    <div class="w-[70%] mb-2 lg:mb-0">
                        <label class="block text-[12px] lg:text-[14px] mb-2">Email</label>
                        <input type="text" id="email" name="email" class="appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline font-light text-[12px] lg:text-[14px]">
                    </div>  
                    <div class="w-[30%]">
                        <label class="block text-[12px] lg:text-[14px] mt-3" for="gender">Gender</label>
                        <select id="gender" name="gender" class="appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline font-light text-[12px] lg:text-[14px]">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                    </div> 
                </div>
                <!-- Bio -->
                <div class="w-full">
                    <label class="block text-[12px] lg:text-[14px] mb-2">Bio</label>
                    <input type="text" id="bio" name="bio" class="appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline font-light text-[12px] lg:text-[14px]">
                </div>  
                <button type="submit" class="cursor-pointer text-[12px] lg:text-[14px] bg-mainGreen hover:bg-bgBlue text-white py-2 px-4 border font-light">Save Changes</button>
                </div>             
            </form>
        </div>
    </main>

    <script>
        const token = localStorage.getItem('accessToken'); 
        // Fetch profile data to pre-fill the form
        fetch('http://127.0.0.1:8000/api/profile/', {
            headers: {
                'Authorization': `Bearer ${token}`,
            },
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('first_name').value = data.user.first_name || '';
            document.getElementById('last_name').value = data.user.last_name || '';
            document.getElementById('username').value = data.user.username || '';
            document.getElementById('email').value = data.user.email || '';
            document.getElementById('bio').value = data.profile.bio || '';
            document.getElementById('gender').value = data.profile.gender || '';
            document.getElementById('emails').textContent = data.user.email || '';
        })
        .catch(error => console.error('Error fetching profile:', error));

        // Handle form submission
        document.getElementById('edit-profile-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData();
            formData.append('email', document.getElementById('first_name').value);
            formData.append('email', document.getElementById('last_name').value);
            formData.append('email', document.getElementById('username').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('bio', document.getElementById('bio').value);
            formData.append('gender', document.getElementById('gender').value);
            formData.append('profile_pic', document.getElementById('profile_pic').files[0]);

            fetch('http://127.0.0.1:8000/api/profile/', {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message); 
                } else {
                    alert('Profile updated successfully!');
                }
            })
            .catch(error => console.error('Error updating profile:', error));
        });
    </script>
</body>
</html>